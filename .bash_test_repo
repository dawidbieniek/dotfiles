#!/bin/bash

function check_repos() {
	# Checks whether there is internet connection with timeout of 1s	
	timeout 1 bash -c '{ echo -e "GET http://google.com HTTP/1.0\n\n" | nc -w1 google.com 80 > /dev/null 2>&1; }'
	if [ $? -ne 0 ]; then 
		echo "${reset}Login: {yellow}Offline"
		return
	fi

	function check_repo() {
		local repoPath=$1
		
		if [ ! -d $repoPath ]; then
			return
		fi
		
		# Compare remote HEAD hash with local HEAD hash
		if [ $(git -C "$repoPath" rev-parse HEAD) != $(git -C "$repoPath" ls-remote origin HEAD | awk '{print $1}') ]; then
			echo "${reset}Login: ${red}Repository '$1' needs to be fetched${reset}"
		else
			echo "${reset}Login: ${green}Repository '$1' up to date"
		fi
	}

	local dotfilesRepoPath="/home/dawid/.dotfiles"
	local scriptsRepoPath="/home/dawid/scripts"

	check_repo "$dotfilesRepoPath"
	check_repo "$scriptsRepoPath"
	
	unset check_repo
}

# Call the function
check_repos

unset check_repos